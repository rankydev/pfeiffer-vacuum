version: '3.8'

services:
  pvweb:
    image: "${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG}"
    deploy:
      mode: replicated
      replicas: ${CONTAINER_REPLICAS}
      placement:
        max_replicas_per_node: ${CONTAINER_REPLICAS_PER_NODE}
      update_config:
        parallelism: 1
        delay: 10s
        order: stop-first
      resources:
        limits:
          cpus: "${CONTAINER_LIMIT_CPU}"
          memory: "${CONTAINER_LIMIT_MEMORY}"
        reservations:
          cpus: "${CONTAINER_RESERVE_CPU}"
          memory: "${CONTAINER_RESERVE_MEMORY}"
    ports:
      - "${PORT}:${PORT}"
    environment:
      - PORT=${PORT}
      - NODE_ENV=${NODE_ENV}
      # Language
      - DEFAULT_LANGUAGE_CODE=${DEFAULT_LANGUAGE_CODE}
      - LANGUAGE_CODES=${LANGUAGE_CODES}
      # Region
      - REGION_CODES=${REGION_CODES}
      - DEFAULT_REGION_CODE=${DEFAULT_REGION_CODE}
      - CURRENT_REGION_CODE=${CURRENT_REGION_CODE}
      # storyblok
      - STORYBLOK_ACCESS_TOKEN=${STORYBLOK_ACCESS_TOKEN}
      - STORYBLOK_SPACE_ID=${STORYBLOK_SPACE_ID}
      - STORYBLOK_VERSION=${STORYBLOK_VERSION}
      - STORYBLOK_RESOLVE_RELATIONS=${STORYBLOK_RESOLVE_RELATIONS}
      - STORYBLOK_RESOLVE_LINKS=${STORYBLOK_RESOLVE_LINKS}
      - STORYBLOK_RESOLVE_ASSETS=${STORYBLOK_RESOLVE_ASSETS}
      - STORYBLOK_CONTENT_TYPES=${STORYBLOK_CONTENT_TYPES}
      - STORYBLOK_EXCLUDE_ROUTES=${STORYBLOK_EXCLUDE_ROUTES}
      - STORYBLOK_OAUTH_TOKEN=${STORYBLOK_OAUTH_TOKEN}
      - STORYBLOK_IMAGE_BASE_URL=${STORYBLOK_IMAGE_BASE_URL}
      - BASE_URL=${BASE_URL}
      - CI_COMMIT_SHORT_SHA=${CI_COMMIT_SHORT_SHA}
      - CI_COMMIT_REF_NAME=${CI_COMMIT_REF_NAME}
      - CI_PROJECT_URL=${CI_PROJECT_URL}
      - USERCENTRICS_PRIVACY_PATH=${USERCENTRICS_PRIVACY_PATH}
      - USERCENTRICS_ID=${USERCENTRICS_ID}
      # node setup
      - IGNORE_SSL_CERT=${IGNORE_SSL_CERT} #don't trust all certificates
      # hybris
      - SHOP_BASE_URL=${SHOP_BASE_URL}
      - SHOP_IMAGE_URL=${SHOP_IMAGE_URL}
      # keycloak
      - KEYCLOAK_BASE_URL=${KEYCLOAK_BASE_URL}
      - KEYCLOAK_REALM_NAME=${KEYCLOAK_REALM_NAME}
      - KEYCLOAK_CLIENT_ID=${KEYCLOAK_CLIENT_ID}
      # google tag manager
      - GOOGLE_TAG_MANAGER_ID=${GOOGLE_TAG_MANAGER_ID}

      # vsm
      #- VSM_BASE_URL=https://testing-pv.vsm-cloud.com
      #- VSM_TECHNICAL_USER_TOKEN=10fff01e72e34e4fe33fbc84e5c6aa80017aac08
      # determines whether all service features (VSM) are shown or not
      #- SERVICE_PORTAL_ACTIVE=true
      # logging
      - CONSOLA_LEVEL=${CONSOLA_LEVEL} # { 0: 'error', 1: 'warn', 2: 'log', 3: 'info', 4: 'debug', 5: 'trace', Infinite: silent }
      # Google Tag Manager for Google Analytics
      #- GOOGLE_TAG_MANAGER_ID=${CI_GOOGLE_TAG_MANAGER_ID}
